---
title: "ë¸”ë¡œê·¸ ê°œë°œê¸° (ToC - Table of Contents)"
thumbnail: "/images/blog/nextjs-blog/implementing-toc/thumbnail.webp"
introduction: "ë¸”ë¡œê·¸ ë³¸ë¬¸ì— ëŒ€í•œ ToC (Table of Contents)ë¥¼ êµ¬í˜„í•œ ê³¼ì •ì„ ë‹´ì•˜ìŠµë‹ˆë‹¤."
keywords: "Table of Contents, Rehype-Slug"
createdAt: "2024-12-07 ì˜¤í›„ 08:30:00"
---

ì•ˆë…•í•˜ì„¸ìš” youngminss ì…ë‹ˆë‹¤. ì´ë²ˆ ê¸€ì—ì„œëŠ” `Table of Content` (ì´í•˜, `ToC`) ë¥¼ ë¸”ë¡œê·¸ ìƒì„¸ í˜ì´ì§€ì— ì¶”ê°€í•œ ê³¼ì •ì„ ì†Œê°œí•˜ë ¤ í•©ë‹ˆë‹¤.

ê¸€ì„ ì‘ì„±í•  ë•ŒëŠ” `ëª©ì°¨`ë¥¼ ë‘ëŠ”ë°ìš”, **ToC** ê°€ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ë©´ ê·¸ "ëª©ì°¨"ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
ToC ë¥¼ ê¸€ ìƒì„¸ í˜ì´ì§€ì— ë°°ì¹˜í•˜ë©´ **ToC ë§Œ ë´ë„ ì¼ì°¨ì ìœ¼ë¡œ í•´ë‹¹ ê¸€ì—ì„œ ì†Œê°œí•  ì†Œì¬ë“¤ì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤ëŠ” ì **ê³¼ **í•„ìš”í•  ë•Œ ë¹ ë¥´ê²Œ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™ì´ ê°€ëŠ¥í•  ìˆ˜ ìˆë‹¤ëŠ” ì **ì´ ì´ì ìœ¼ë¡œ ìƒê°ì´ ë“¤ì–´ ì¶”ê°€í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

<br />

## ğŸ¤” ìš”êµ¬ì‚¬í•­ ë¶„ì„

í•˜ë‚˜ì˜ ê¸€ì—ëŠ” í•˜ë‚˜ì˜ **ì£¼ ì œëª©**ì´ í•˜ë‚˜ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œí¸ í•˜ë‚˜ì˜ ê¸€ ì•ˆì—ì„œë„ ëª©ì°¨ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆê³  ì´ë¥¼ ì—¬ëŸ¬ ê°œì˜ **ë¶€ ì œëª©**ìœ¼ë¡œ êµ¬ë¶„ ì§€ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

HTMLì—ì„œ **ì œëª©**ê³¼ ê´€ë ¨ëœ íƒœê·¸ëŠ” `h Tag` (= heading)ì…ë‹ˆë‹¤. ë³´í†µ **ì¤‘ìš”ë„**ì— ë”°ë¼ h1 ~ h6 ê¹Œì§€ **ê³„ì¸µ**ì„ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸€ì—ì„œëŠ” ì£¼ ì œëª©(h1) ì„ ì‹œì‘ìœ¼ë¡œ ì—¬ëŸ¬ í•˜ìœ„ ì†Œì œëª©(h2 ~ h6) ë“¤ë¡œ ê³„ì¸µì„ ë‘”ë‹¤ê³  ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë³´í†µ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ê¸€ì„ ë³´í†µ ì‘ì„±í•©ë‹ˆë‹¤.

```markdown title="ê¸€ êµ¬ì¡° ì˜ˆì‹œ"
## ì†Œì œëª© 1

ë‚´ìš©...

## ì†Œì œëª© 2

ë‚´ìš©...

### ì†Œì œëª© 2 ì˜ ì†Œì œëª© 1

ë‚´ìš©...

## ì†Œì œëª© 3

ë‚´ìš©...
```

ìš°ë¦¬ì—ê²Œ í•„ìš”í•œ ê²ƒì€ HTML ë¡œ ë³€í™˜ëœ ê¸€ ë‚´ìš©ì—ì„œ **h2 ~ h6ì— í•´ë‹¹í•˜ëŠ” ë¸”ë¡ì˜ ì •ë³´**ê°€ í•„ìš”í•©ë‹ˆë‹¤. **h1** ì€ ê¸€ì˜ ì œëª©ì—ì„œ ì‚¬ìš©í•˜ë‹ˆê¹Œìš”! ([h1ì€ ë³´í†µ í˜ì´ì§€ì—ì„œ 1ê°œë§Œ ì‚¬ìš©ë˜ëŠ” ê²ƒì„ "ê¶Œì¥"í•œë‹¤.](https://support.google.com/webmasters/thread/250613606?hl=en&msgid=250870751))

ì¢€ ë” êµ¬ì²´í™”í•˜ìë©´ ì €ì˜ ê²½ìš°ëŠ” **h2, h3 ì˜ ì •ë³´ë§Œ í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.** ê·¸ ì´ìƒì˜ ê³„ì¸µìœ¼ë¡œ ê¸€ì„ ì‘ì„±í•˜ê³  ìˆì§€ ì•Šìœ¼ë©°, ë§Œì•½ ê·¸ëŸ° ê²½ìš°ë¼ë©´ ëª©ì°¨ì˜ ê¹Šì´ë¥¼ ì¡°ì ˆí•´ì„œ h4 ì´ìƒìœ¼ë¡œëŠ” í•„ìš”í•˜ì§€ ì•Šë„ë¡ êµ¬ì¡°ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ë§ëŠ”ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

ì¶”ì¶œí•œ h2, h3 ë¸”ë¡ì˜ ì •ë³´ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ToC ì™€ ê°™ì´ ê·¸ë ¤ì£¼ê¸°ë§Œ í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì´ ì²« ë²ˆì§¸ íƒœìŠ¤í¬ê°€ ë  ê²ƒì…ë‹ˆë‹¤.

ê·¸ë‹¤ìŒì€ ToC ì—ì„œ í•„ìš”í•œ ê¸°ëŠ¥ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì œê°€ ì •ì˜í•œ ToC ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.

- ToC ì˜ ì•„ì´í…œì„ í´ë¦­í•˜ë©´ `í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™` ë˜ì–´ì•¼ í•œë‹¤.
- ToC ì•„ì´í…œì„ í´ë¦­ì´ë‚˜ ìŠ¤í¬ë¡¤ì„ í†µí•´ íŠ¹ì • ë¶€ì œëª© ì„¹ì…˜ì— í•´ë‹¹í•˜ëŠ” ToC ì•„ì´í…œì´ `í•˜ì´ë¼ì´íŒ…` ë˜ì–´ì•¼ í•œë‹¤.
- ê¸€ ë³¸ë¬¸ì´ ëë‚˜ëŠ” ì˜ì—­ ë°‘ìœ¼ë¡œëŠ” ToC ê°€ ì•ˆë³´ì˜€ìœ¼ë©´ ì¢‹ê² ë‹¤.

ì•„ë˜ë¶€í„°ëŠ” ì–´ë–¤ ê³¼ì •ìœ¼ë¡œ ì§„í–‰í–ˆëŠ”ì§€ ê¸°ìˆ í•˜ê² ìŠµë‹ˆë‹¤.

<br />
<br />

## âœ… ì–´ë–»ê²Œ ëª©ì°¨ ì •ë³´ë¥¼ ì¶”ì¶œí•  ê²ƒì¸ê°€ ?

ì¼ë‹¨, ë³¸ë¬¸ ë‚´ markdownì—ì„œ heading ì²˜ë¦¬ë¥¼ í•œ ì½˜í…ì¸ ê°€ ë Œë”ë§ ëœ ê²°ê³¼ ì˜ˆì‹œë¥¼ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.

![image-1](/images/blog/nextjs-blog/implementing-toc/image-1.webp)

markdownì—ì„œ **"##"** ë¡œ ì‘ì„±í•œ ê²ƒì´ **h2 íƒœê·¸**ë¡œ ë Œë”ë§ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì½˜í…ì¸  ë‚´ h2, h3 íƒœê·¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤. h íƒœê·¸ë“¤ì˜ ì •ë³´ëŠ” `querySelector` ë¥¼ ì‚¬ìš©í•´ì„œ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½˜í…ì¸  ë‚´ **ëª¨ë“ ** h2, h3 íƒœê·¸ì— ëŒ€í•œ ì •ë³´ê°€ í•„ìš”í•œ ê²ƒì´ê¸° ë•Œë¬¸ì— [Document.querySeletorAll](https://developer.mozilla.org/ko/docs/Web/API/Document/querySelectorAll) selector ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œ ë¸”ë¡ì—ì„œ **line 7** ì´ ê·¸ ë¶€ë¶„ì…ë‹ˆë‹¤.

```ts title="ToC ë°ì´í„°ë¥¼ ì¶”ì¶œ" showLineNumbers {7, 13}
useEffect(() => {
  // cc. ì»¨í…ì¸  ë³¸ë¬¸ ì»´í¬ë„ŒíŠ¸ì— "post-body" ë¼ëŠ” ì´ë¦„ì˜ id ê°’ì„ ì„¤ì •í•´ë†“ì•˜ìŒ
  const $postBody = document.getElementById("post-body");

  if ($postBody) {
    // step 1 : h2 ~ h3 íƒœê·¸ê¹Œì§€ ì¶”ì¶œ
    const hTagList = $postBody.querySelectorAll("h2, h3");

    // step 2 : ToC ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°
    const postToCListTemp: IToCItem[] = [];

    hTagList.forEach((hTagItem) => {
      const { id: href, nodeName: level, textContent: text } = hTagItem;

      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      const absoluteTop = hTagItem.getBoundingClientRect().top + scrollTop;

      postToCListTemp.push({
        level,
        text,
        href,
        absoluteTop: absoluteTop,
      });
    });

    if (postToCListTemp.length !== 0) {
      setPostToCList(postToCListTemp);
    }
  }
}, []);
```

**line 10** ë¶€í„°ëŠ” ê° NodeList ë¥¼ ëŒë©´ì„œ Node ì˜ ì†ì„± ì¤‘ì— ToC ìƒì„±ì— í•„ìš”í•œ ì†ì„±ë§Œ ë½‘ì•„ë‚´ì„œ ToC ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. line 13ì—ì„œ ê° h tag nodeì— ëŒ€í•´ ToC ì— í•„ìš”í•œ ì†ì„±ë“¤ì„ ë½‘ì•„ëƒ…ë‹ˆë‹¤. ê°ê°ì˜ ì†ì„±ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…ì„ í•˜ê² ìŠµë‹ˆë‹¤.

- `id` : h tag ì˜ id ì…ë‹ˆë‹¤. id ì— í•´ë‹¹í•˜ëŠ” h tag ê°€ ìˆëŠ” ì„¹ì…˜ìœ¼ë¡œ ì´ë™ ì‹œ í•„ìš”í•©ë‹ˆë‹¤.
- `nodeName` : h tag ì˜ level (ex. h1, h2, h3 ...) ì…ë‹ˆë‹¤. ToC ì˜ ë“¤ì—¬ì“°ê¸° ê³„ì¸µì„ í‘œí˜„í•  ë•Œ í•„ìš”í•©ë‹ˆë‹¤.
- `textContent` : h tag ì˜ text ì…ë‹ˆë‹¤. ToC ì•„ì´í…œì— í‘œí˜„ë  ì½˜í…ì¸ ì— í•„ìš”í•©ë‹ˆë‹¤.

nodeName ì´ë‚˜ textContent ëŠ” markdownì—ì„œ ì˜ ì‘ì„±ë§Œ í–ˆë‹¤ë©´ ì¡´ì¬í•˜ëŠ” ê°’ ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ `id` ì— ëŒ€í•´ì„œëŠ” ì¶”ê°€ë¡œ ì„¤ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.

ìœ„ì—ì„œ ì˜ˆì‹œë¡œ ì²¨ë¶€í•œ ë Œë”ë§ ëœ ê²°ê³¼ì—ì„œëŠ” h tag ì— id ì†ì„±ì´ ì—†ì—ˆëŠ”ë° ì–´ë–»ê²Œ ì¶”ì¶œí•  ìˆ˜ ìˆëŠ” ê²ƒì¼ê¹Œìš”? ì´ë¥¼ ìœ„í•´ì„œëŠ” mdx rehype plugin ì¸ [rehype-slug](https://github.com/rehypejs/rehype-slug) ì„ í™œìš©í–ˆìŠµë‹ˆë‹¤. **rehype-slug** ëŠ” **h tag ì— id ë¥¼ ìë™ìœ¼ë¡œ ì‚½ì…í•´ ì£¼ëŠ” rehype plugin ì…ë‹ˆë‹¤.** **tag ë‚´ì˜ text ë¥¼ ê¸°ë°˜ìœ¼ë¡œ id ì†ì„±ì„ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.** (cc. [github-slugger](https://github.com/Flet/github-slugger))

ì•„ë˜ ì˜ì¡´ì„± íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.

```shell
npm install rehype-slug
```

ê·¸ë¦¬ê³  MDX ì»´í¬ë„ŒíŠ¸ì˜ options ì†ì„±ì— rehype ì˜ì¡´ì„± ë°°ì—´ ì†ì„±ì— ì„¤ì¹˜í•œ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤. ì €ëŠ” MDXRemote ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê³  ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```tsx title="MDX í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ rehype-slug ë¥¼ ì¶”ê°€" showLineNumbers {15-18}
import { TPost } from "@/types/post";
import { MDXRemote } from "next-mdx-remote/rsc";
import rehypeSlug from "rehype-slug";

...

const PostBody = ({ post }: { post: TPost }) => {
  return (
      <MDXRemote
		   ...
        source={post.content}
        options={{
          mdxOptions: {
            ...
            rehypePlugins: [
              rehypeSlug,
              ...
            ],
          },
        }}
      />
  );
};

export default PostBody;
```

ë Œë”ë§ ëœ ê²°ê³¼ì—ì„œ h tagì— id ì†ì„±ì´ ìë™ìœ¼ë¡œ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-2](/images/blog/nextjs-blog/implementing-toc/image-2.webp)

ì´ë ‡ê²Œ ToC ì— í•„ìš”í•œ id ì •ë³´ê¹Œì§€ í™œìš©í•  ìˆ˜ ìˆê²Œ ëìŠµë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ToC ë Œë”ë§ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.

<br />
<br />

## âœ… ToC ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™

ToC ë°ì´í„°ë¥¼ í†µí•´ ë³¸ì¸ ìŠ¤íƒ€ì¼ì— ë§ëŠ” í˜•íƒœë¡œ UIë¥¼ ìƒì„±í•˜ë©´ ë©ë‹ˆë‹¤. ì €ëŠ” ì•„ë˜ì™€ ê°™ì€ UI ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤. (UI ì— ëŒ€í•œ ì„¤ëª…ì€ í•µì‹¬ì´ ì•„ë‹ˆë¼ì„œ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤. ìì„¸í•œ ê²ƒì€ [repo](https://github.com/youngminss/youngminss-log/blob/main/src/components/post/PostToC.tsx) ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš” !)

![image-3](/images/blog/nextjs-blog/implementing-toc/image-3.webp)

ë‹¤ìŒ í•  ì‘ì—…ì€ íŠ¹ì • ToC ì•„ì´í…œì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ì˜ì—­ìœ¼ë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì´ì „ ë‹¨ê³„ì—ì„œ ToC ì•„ì´í…œì— í•„ìš”í•œ ë°ì´í„° ì¤‘ì— id íƒœê·¸ë¥¼ Next.js ì˜ `íƒœê·¸ href ì†ì„±ì— "#{id}" í˜•íƒœë¡œ ì£¼ì…í•´ ì£¼ë©´ ë©ë‹ˆë‹¤.` ê·¸ë¦¬ê³  íƒœê·¸ì— ì •ì˜í•œ onClick ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.

```tsx title="ì„¹ì…˜ ë‚´ ì´ë™ì„ ìœ„í•œ ì½”ë“œ ë¸”ë¡" showLineNumbers
"use client";

...

import Link from "next/link";
import { useRouter } from "next/navigation";
import { MouseEventHandler ... } from "react";

...

const PostToC = ({ ... }) => {
  const router = useRouter();

  ...

  const handleToCItemClick: MouseEventHandler<HTMLAnchorElement> = (event) => {
    event.preventDefault();

    const decodedHashId = decodeURIComponent(event.currentTarget.hash);
    const scrollTargetId = decodedHashId.replace(/.*\#/, "");
    const $scrollTarget = document.getElementById(scrollTargetId);
    const $header = document.getElementById("blog-header");

    if ($scrollTarget) {
      // 1. change url hash
      router.push(decodedHashId, { scroll: false });

      // 2. smooth scroll target section
      window.scrollTo({
        top: $scrollTarget.offsetTop - ($header?.offsetHeight ?? 0),
        behavior: "smooth",
      });
    }
  };

  return (
      <>
        ...
		{postToCList.map((postToCItem, index) => {
	        const { level, text, href } = postToCItem;

            ...
            return (
                <Link
                  href={`#${href}`}
                  onClick={handleToCItemClick}
                >
                  {text}
                </Link>
            );
        })}

        ...
      </>
  );
};

export default PostToC;

```

**onClick** ì— ë“±ë¡í•œ handleToCItemClick í•¸ë“¤ëŸ¬ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ í•©ë‹ˆë‹¤.

1. event ê°ì²´ì— ë“±ë¡ëœ hash ê°€ ìˆìœ¼ë©´ ì´ë¥¼ decode & refine í•´ì„œ element ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ id ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
2. id ì— í•´ë‹¹í•˜ëŠ” **element ì˜ offsetTop** - **í˜ì´ì§€ í—¤ë”ì˜ offsetHeight ê°’** ë§Œí¼ ë¸Œë¼ìš°ì €ë¥¼ ìŠ¤í¬ë¡¤ í•©ë‹ˆë‹¤.

decode & refine í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•œ ì´ìœ ëŠ” hash ê·¸ëŒ€ë¡œ ê°’ì„ ì‚¬ìš©í•˜ë©´ encode ëœ ê°’ì´ê¸° ë•Œë¬¸ì— ì›í•˜ëŠ” í˜•íƒœì˜ id ë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì‹¤ì œë¡œ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸í•´ ë³´ë©´ ì•„ë˜ ì²¨ë¶€í•œ ì´ë¯¸ì§€ì™€ ê°™ì´ **decodedHashId (decode) -> scrollTargetId (refine) -> $scrollTarget** ìˆœìœ¼ë¡œ **getElementById** ì—°ì‚°ì— í•„ìš”í•œ id ê°’ì´ ì¶”ì¶œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-4](/images/blog/nextjs-blog/implementing-toc/image-4.webp)

**getElementById** ìœ¼ë¡œ element ê°€ ìˆë‹¤ë©´ window.scrollTo ë¡œ ìŠ¤í¬ë¡¤ í•˜ê¸° ì „ì— Next.js ì˜ `Link` íƒœê·¸ `ê¸°ë³¸ ì‘ë™ ìŠ¤í¬ë¡¤ì„ ë§‰ê¸° ìœ„í•´ router.push ì‹œ { scroll : false }` param ì„ ì„¤ì •í•©ë‹ˆë‹¤. **Link** íƒœê·¸ì˜ ê¸°ë³¸ ì‘ë™ì¸ ìŠ¤í¬ë¡¤ì„ ìµœìƒë‹¨ìœ¼ë¡œ ì´ë™ì‹œí‚¤ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. (cc. [ì°¸ê³ ](https://nextjs.org/docs/app/api-reference/components/link#disable-scrolling-to-the-top-of-the-page))

ì œê°€ ì›í•œ ë™ì‘ì€ ToC ì•„ì´í…œì— í•´ë‹¹í•˜ëŠ” ì˜ì—­ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤ ë˜ì–´ ì´ë™í•˜ê¸¸ ì›í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ window ë¥¼ ì§ì ‘ ì¡°ì‘í•´ì„œ Header ë°”ë¡œ ë°‘ìœ¼ë¡œ ì´ë™í•  ì˜ì—­ì˜ ì‹œì‘ì ìœ¼ë¡œ ì´ë™ì‹œì¼°ìŠµë‹ˆë‹¤.

![video-1](/images/blog/nextjs-blog/implementing-toc/video-1.gif)

<br />
<br />

## âœ… íŠ¹ì • ì„¹ì…˜ì— í•´ë‹¹í•˜ëŠ” ToC ì•„ì´í…œ í•˜ì´ë¼ì´íŒ…

ë‹¤ìŒìœ¼ë¡œ ToC ì—ì„œ ë‚´ê°€ ì½ëŠ” ë¶€ë¶„ì´ ê¸€ì˜ ì–´ëŠ ë¶€ë¶„ì¸ì§€ ì¸ì§€ì‹œì¼œ ì£¼ë©´ ì¢‹ê² ë‹¤ê³  ìƒê°í•˜ì—¬ í•˜ì´ë¼ì´íŒ… ê¸°ëŠ¥ì„ ì¶”ê°€ë¡œ ë„£ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤.

1. í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜
2. í˜„ì¬ ìŠ¤í¬ë¡¤ì— í•´ë‹¹í•˜ëŠ” ToC ì•„ì´í…œ

ìŠ¤í¬ë¡¤ ì •ë³´ë¥¼ ì €ëŠ” state ì— ë‹´ì•˜ìŠµë‹ˆë‹¤. [Web API - Intersection Observer](https://developer.mozilla.org/ko/docs/Web/API/Intersection_Observer_API) ë¥¼ ì‚¬ìš©í•˜ë©´ state ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ì‰½ê³  ì„±ëŠ¥ ì¸¡ë©´ì—ì„œë„ ë¶ˆí•„ìš”í•œ ìŠ¤í¬ë¡¤ state ë¥¼ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì¥ì ì´ ìˆì—ˆì§€ë§Œ, **ìŠ¤í¬ë¡¤ì„ ë¹ ë¥´ê²Œ ë‚´ë¦¬ëŠ” ì•¡ì…˜ì—ì„œ ëŒ€ì‘ì´ ì•ˆë˜ëŠ” ì´ìŠˆ**ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. (cc. [ì°¸ê³ ](https://stackoverflow.com/questions/61951380/intersection-observer-fails-sometimes-when-i-scroll-fast))

ë¸”ë¡œê·¸ì— ê¸€ì„ ì½ëŠ” ê²ƒ ì™¸ì—ëŠ” ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ë³„ë‹¤ë¥¸ ê¸°ëŠ¥ì€ ì—†ì—ˆê¸°ì— UX ì— ë¬¸ì œê°€ ì—†ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•´ì„œ ì´ ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

```tsx title="ToC í•˜ì´ë¼ì´íŒ…ì„ ìœ„í•œ ì½”ë“œ ë¸”ë¡" showLineNumbers
"use client";

import { throttle } from "@/functions/browser";
...

const PostToC = ({ ... }) => {
  const [postToCList, setPostToCList] = useState<IToCItem[]>([]);
  const isToCReady = postToCList.length !== 0;

  // ìŠ¤í¬ë¡¤ state
  const [scrollY, setScrollY] = useState(isServerSide ? 0 : window.scrollY);

  // í•˜ì´ë¼ì´íŒ… ë˜ì–´ì•¼í•˜ëŠ” ToC ì•„ì´í…œ state
  const [highlightToCItem, setHighlightToCItem] = useState<IToCItem>();

  // ê°€ì¥ ìµœê·¼ í•˜ì´ë¼ì´íŒ… ëœ ToC ì•„ì´í…œ state (ğŸ”)
  const [lastHighlightToCItem, setLastHighlightToCItem] = useState<IToCItem>();

  ...

  // 1. ìŠ¤í¬ë¡¤ state ì—…ë°ì´íŠ¸ (with. throttle)
  useEffect(() => {
    const handleScroll = throttle(() => {
      setScrollY(window.scrollY);
    }, 200);
    handleScroll();

    if (!isServerSide) {
      window.addEventListener("scroll", handleScroll);
    }

    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  }, [isServerSide]);


  // 2. í˜„ì¬ ìŠ¤í¬ë¡¤ì— í•´ë‹¹í•˜ëŠ” ToC ì•„ì´í…œ state ì—…ë°ì´íŠ¸
  useEffect(() => {
    const handleToCHighlight = () => {
      if (postToCList.length !== 0) {
        const candidateHighlightToCList = postToCList.filter((postToCItem) => {
          const { absoluteTop } = postToCItem;

          return (
            scrollY <= absoluteTop &&
            absoluteTop < scrollY + document.documentElement.clientHeight
          );
        });

        if (candidateHighlightToCList.length !== 0) {
          setLastHighlightToCItem(candidateHighlightToCList.at(0));
        }

        const isToCArea =
          scrollY + document.documentElement.clientHeight >
          (postToCList.at(0)?.absoluteTop ?? 0);

        setHighlightToCItem(
          isToCArea
            ? candidateHighlightToCList?.at(0) ?? lastHighlightToCItem
            : undefined,
        );
      }
    };

    handleToCHighlight();
  }, [isToCReady, scrollY]);

  return (
    <aside>
        <>
          {postToCList.map((postToCItem) => {
            const { text, href } = postToCItem;

			// í•˜ì´ë¼ì´íŒ… TocItem ì˜ text ì™€ ê°™ì„ ê²½ìš° í•˜ì´ë¼ì´íŒ…
            const isHighlight = text === highlightToCItem?.text;

            return (
              <div
				key={`toc-item-${text}`}
                className={`${isHighlight ? `font-semibold text-[var(--highlight)]` : ``}`}
              >
                <Link
                  ...
                >
                  {text}
                </Link>
              </div>
            );
          })}
        </>
    </aside>
  );
};

export default PostToC;
```

ìœ„ ì½”ë“œì—ì„œ ë‘ ê°œì˜ useEffect ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ useEffect ì—ì„œëŠ” [throttle](https://developer.mozilla.org/en-US/docs/Glossary/Throttle) ë¥¼ ì£¼ì–´ ìŠ¤í¬ë¡¤ ì •ë³´(= ì´í•˜ scrollY) ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ë‘ ë²ˆì§¸ useEffect ì—ì„œëŠ” ToC ì•„ì´í…œ state ìƒì„± ì‹œ ê³„ì‚°í–ˆë˜ ToC ì•„ì´í…œë“¤ì˜ ìœ„ì¹˜ì™€ scrollY ê°’ì„ ë¹„êµí•´ì„œ í•˜ì´ë¼ì´íŒ… ë˜ì–´ì•¼í•˜ëŠ” ToC ì•„ì´í…œ state ë¥¼ ì¶”ì¶œí•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

<br />
<br />

## ğŸ˜¢ ë§Œë‚¬ë˜ ì´ìŠˆ

scrollY ë³€í™”ì— ë”°ë¼ ë‘ ë²ˆì§¸ useEffect ê°€ ì‹¤í–‰ì´ ë˜ë©´ í•˜ì´ë¼ì´íŒ… ë˜ì–´ì•¼í•  ToC ì•„ì´í…œ ê³„ì‚°ì´ ì¬ì‹¤í–‰ë˜ëŠ”ë°ìš”, line 42 ~ 48 line ì˜ ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°(= í˜„ì¬ ë·°í¬íŠ¸ ë²”ìœ„ ì•ˆì— ToC ì•„ì´í…œì´ í•˜ë‚˜ë„ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°) ToC ì•„ì´í…œì—ì„œ í•˜ì´ë¼ì´íŒ…ì´ ì•ˆ ë˜ëŠ” ì—£ì§€ ì¼€ì´ìŠ¤ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

![video-2](/images/blog/nextjs-blog/implementing-toc/video-2.gif)

**lastHighlightToCItem** ì€ ì´ ê²½ìš°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ **ê°€ì¥ ìµœê·¼ì— í•˜ì´ë¼ì´íŒ… ë˜ì—ˆë˜ ToC ì•„ì´í…œ**ì„ state ë¡œ ì €ì¥í•´ë†¨ë‹¤ê°€ ìœ„ì™€ ê°™ì€ ìƒí™©ì— ì‚¬ìš©í•˜ê¸°ìœ„í•œ ToC ì•„ì´í…œ ì •ë³´ì…ë‹ˆë‹¤.

![video-3](/images/blog/nextjs-blog/implementing-toc/video-3.gif)

<br />
<br />

## âœ… ê¸€ ë³¸ë¬¸ì´ ì˜ì—­ì„ ë²—ì–´ë‚˜ë©´ ToC ìˆ¨ê¸°ê¸°

ìŠ¤í¬ë¡¤ì´ ë³¸ë¬¸ ì˜ì—­ ì´ìƒìœ¼ë¡œ ë²—ì–´ë‚¬ì„ ê²½ìš°ì—ëŠ” ToC ê°€ ì‚¬ë¼ì§€ íš¨ê³¼ë¥¼ ì£¼ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ìŠ¤í¬ë¡¤ ê°’ì´ ë³€í•¨ì— ë”°ë¼ í˜„ì¬ ìŠ¤í¬ë¡¤ì´ ë³¸ë¬¸ ì˜ì—­ì„ ë²—ì–´ë‚¬ëŠ”ì§€ë¥¼ ì²´í¬í•˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

ì €ëŠ” ê¸€ ìƒì„¸ í•˜ë‹¨ì— ê³µí†µìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” **ëŒ“ê¸€ ì„¹ì…˜** ì˜ ë…¸ì¶œ ì—¬ë¶€ë¡œ ì´ë¥¼ íŒë‹¨í–ˆìŠµë‹ˆë‹¤. ì•½ê°„ì˜ offset (= ì‚¬ìš©ì ë¸Œë¼ìš°ì € height ì˜ 1/2 í¬ê¸°) ì„ ì£¼ì–´ì„œ ëŒ“ê¸€ ì˜ì—­ì´ ì ˆë°˜ ì´ìƒ ë³´ì´ê¸° ì‹œì‘í•˜ë©´ ToC ê°€ ì‚¬ë¼ì§€ëŠ” íš¨ê³¼ë¥¼ ì£¼ì—ˆìŠµë‹ˆë‹¤.

```tsx title="ToC ë…¸ì¶œ ì œì–´ë¥¼ ìœ„í•œ ì½”ë“œ ë¸”ë¡" showLineNumbers
"use client";

...

const PostToC = ({ ... }) => {
  const [isPostToCEnd, setIsPostToCEnd] = useState<boolean>();

  ...

  // 2. í˜„ì¬ ìŠ¤í¬ë¡¤ì— í•´ë‹¹í•˜ëŠ” ToC ì•„ì´í…œ state ì—…ë°ì´íŠ¸
  useEffect(() => {
    ...

	// ToC ì˜ì—­(= ë³¸ë¬¸)ì„ ë„˜ì—ˆëŠ”ì§€ (= ê¸€ ìƒì„¸ í•˜ë‹¨ ëŒ“ê¸€ ì„¹ì…˜ì˜ ë…¸ì¶œ ì—¬ë¶€ë¡œ íŒë‹¨)
    const handlePostToCEnd = () => {
      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      const $commentsSection = document.getElementById(
        "comments-giscus-container",
      );

      if ($commentsSection) {
        const commentsSectionAbsoluteTop =
          $commentsSection?.getBoundingClientRect().top + scrollTop;
        const offset = document.documentElement.clientHeight / 2;

        const isPostToCEnd =
          scrollY + document.documentElement.clientHeight >
          commentsSectionAbsoluteTop + offset;

        setIsPostToCEnd(isPostToCEnd);
      }
    };

	...

    handlePostToCEnd();
  }, [isToCReady, scrollY]);

  return (
    <aside
      className={`transition-opacity duration-300 ${isPostToCEnd ? `opacity-0` : `opacity-100`} ...`}
    >
        <>
          {postToCList.map((postToCItem) => {
            const { text, href } = postToCItem;

			// í•˜ì´ë¼ì´íŒ… TocItem ì˜ text ì™€ ê°™ì„ ê²½ìš° í•˜ì´ë¼ì´íŒ…
            const isHighlight = text === highlightToCItem?.text;

            return (
              <div
				key={`toc-item-${text}`}
                className={`${isHighlight ? `font-semibold text-[var(--highlight)]` : ``}`}
              >
                <Link
                  ...
                >
                  {text}
                </Link>
              </div>
            );
          })}
        </>
    </aside>
  );
};

export default PostToC;
```

![video-4](/images/blog/nextjs-blog/implementing-toc/video-4.gif)

<br />
<br />

## ğŸ‘‹ ê¸€ì„ ë§ˆì¹˜ë©°

ì´ë²ˆ ê¸€ì—ì„œëŠ” ë¸”ë¡œê·¸ì™€ ì½˜í…ì¸  ì„± í˜ì´ì§€ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ë° ë³¸ë¬¸ì˜ êµ¬ì„±ì„ í™•ì¸í•˜ëŠ”ë° ìš©ì´í•œ ì—­í• ì„ í•˜ëŠ” ToC ë¥¼ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì— ëŒ€í•´ ì†Œê°œí–ˆìŠµë‹ˆë‹¤. í‰ì†Œì— íƒ€ ë¸”ë¡œê·¸ë¥¼ êµ¬ê²½í•˜ë©´ì„œ ToC ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í–ˆëŠ”ì§€ ê¶ê¸ˆí–ˆëŠ”ë°ìš”.

IntersectionObserver ê°™ì€ Web API ë¥¼ í™œìš©í•œ ì—¬ëŸ¬ ì‚¬ë¡€ë“¤ë„ í™•ì¸í•  ìˆ˜ ìˆì—ˆê³ , ì´ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•  ê²½ìš° ë¹ ë¥´ê²Œ ìŠ¤í¬ë¡¤ì„ ì§„í–‰í•  ê²½ìš° ì œëŒ€ë¡œ ê°ì§€í•˜ì§€ ëª»í•˜ëŠ” ì—£ì§€ ì¼€ì´ìŠ¤ë„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì§ì ‘ ìŠ¤í¬ë¡¤ ìƒíƒœ ê°’ì„ í™œìš©(with. throttle) í•´ì„œ ê° ToC ì„¹ì…˜ì˜ ë…¸ì¶œ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê³¼ì •ê¹Œì§€ ì§„í–‰í•´ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ğŸ˜‹

ToC êµ¬í˜„ì²´ì— ëŒ€í•´ ë” ê¶ê¸ˆí•œ ì ì€ [repo](https://github.com/youngminss/youngminss-log/blob/main/src/components/post/PostToC.tsx) ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš” !

> ì˜¤ë¥˜ ì œë³´ë‚˜ í”¼ë“œë°±ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤. ğŸ™‚
